<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{TITLE}}</title>

        <!-- Open Props Design Tokens -->
        <link rel="stylesheet" href="{{STYLESHEET_OPEN_PROPS}}" />
        <link rel="stylesheet" href="{{STYLESHEET_NORMALIZE}}" />

        <!-- Noet Themes -->
        <link rel="stylesheet" href="{{STYLESHEET_THEME_LIGHT}}" id="theme-light" />
        <link rel="stylesheet" href="{{STYLESHEET_THEME_DARK}}" id="theme-dark" disabled />

        <!-- Noet Layout -->
        <link rel="stylesheet" href="{{STYLESHEET_LAYOUT}}" />

        <!-- Document Metadata (for viewer.js) -->
        <script type="application/json" id="noet-metadata">
            {{METADATA}}
        </script>
        {{SCRIPT}}
    </head>
    <body>
        <div class="noet-container">
            <!-- Header -->
            <header class="noet-header">
                <div class="noet-header-left">
                    <button id="nav-toggle" class="noet-hamburger" aria-label="Toggle navigation">
                        ☰
                    </button>
                    <h1 class="noet-site-title">{{TITLE}}</h1>
                </div>
                <div class="noet-header-right">
                    <button
                        id="metadata-toggle"
                        class="noet-metadata-toggle"
                        aria-label="Toggle metadata"
                    >
                        Info
                    </button>
                </div>
            </header>

            <!-- Left Navigation -->
            <nav class="noet-nav" id="nav-panel">
                <button
                    class="noet-nav__collapse"
                    id="nav-collapse"
                    aria-label="Collapse navigation panel"
                >
                    ◀
                </button>
                <div class="noet-nav__content">
                    <div class="noet-nav-header">
                        <h2>Navigation</h2>
                    </div>
                    <div id="nav-error" class="noet-error" hidden>
                        <h3 class="noet-error__title">Navigation Error</h3>
                        <p class="noet-error__message">Failed to load navigation data.</p>
                        <button class="noet-error__action" onclick="window.location.reload()">
                            Reload Page
                        </button>
                    </div>
                    <div id="nav-content">
                        <!-- Populated by viewer.js -->
                        <p class="noet-placeholder">Loading navigation...</p>
                    </div>
                </div>
                <div class="noet-nav__footer">
                    <label for="theme-select">Theme:</label>
                    <select id="theme-select" class="noet-theme-select">
                        <option value="system">System</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="noet-content">
                <div class="noet-content__inner">
                    <article>{{CONTENT}}</article>
                </div>
            </main>

            <!-- Right Metadata Panel (hidden by default) -->
            <aside class="noet-metadata" id="metadata-panel" hidden>
                <button
                    class="noet-metadata__collapse"
                    id="metadata-collapse"
                    aria-label="Collapse metadata panel"
                >
                    ▶
                </button>
                <div class="noet-metadata-header">
                    <h2>Metadata</h2>
                    <button
                        id="metadata-close"
                        class="noet-close-btn"
                        aria-label="Close metadata panel"
                    >
                        ×
                    </button>
                </div>
                <div id="metadata-error" class="noet-error" hidden>
                    <h3 class="noet-error__title">Metadata Error</h3>
                    <p class="noet-error__message">Failed to load metadata.</p>
                    <button class="noet-error__action" onclick="window.location.reload()">
                        Reload Page
                    </button>
                </div>
                <div id="metadata-content" class="noet-metadata-content">
                    <!-- Populated by viewer.js when node selected -->
                </div>
            </aside>

            <!-- Graph Visualization Area (future: Step 4) -->
            <div class="noet-graph" id="graph-container" hidden>
                <div class="noet-graph-header">
                    <h2>Graph View</h2>
                    <button id="graph-close" class="noet-close-btn" aria-label="Close graph view">
                        ×
                    </button>
                </div>
                <div id="graph-canvas" class="noet-graph-canvas">
                    <!-- Force-directed graph rendered here -->
                </div>
            </div>

            <!-- Footer -->
            <footer class="noet-footer">
                <p>Generated by <a href="https://github.com/buildonomy/noet-core">Noet</a></p>
            </footer>
        </div>

        <!-- Backdrop overlay for mobile panels -->
        <div id="backdrop" class="noet-backdrop"></div>

        <!-- Viewer Script -->
        <script src="assets/viewer.js"></script>

        <!-- Toggle panel behavior for mobile/tablet -->
        <script>
            (function () {
                const navPanel = document.getElementById("nav-panel");
                const metadataPanel = document.getElementById("metadata-panel");
                const backdrop = document.getElementById("backdrop");
                const navToggle = document.getElementById("nav-toggle");
                const metadataToggle = document.getElementById("metadata-toggle");

                // Toggle navigation panel
                navToggle.addEventListener("click", function () {
                    navPanel.classList.toggle("is-open");
                    backdrop.classList.toggle("is-visible");
                    // Close metadata if open
                    if (metadataPanel.classList.contains("is-open")) {
                        metadataPanel.classList.remove("is-open");
                    }
                });

                // Toggle metadata panel
                metadataToggle.addEventListener("click", function () {
                    metadataPanel.classList.toggle("is-open");
                    backdrop.classList.toggle("is-visible");
                    // Close nav if open
                    if (navPanel.classList.contains("is-open")) {
                        navPanel.classList.remove("is-open");
                    }
                });

                // Close panels when clicking backdrop
                backdrop.addEventListener("click", function () {
                    navPanel.classList.remove("is-open");
                    metadataPanel.classList.remove("is-open");
                    backdrop.classList.remove("is-visible");
                });

                // Close button in metadata panel
                const metadataClose = document.getElementById("metadata-close");
                if (metadataClose) {
                    metadataClose.addEventListener("click", function () {
                        metadataPanel.classList.remove("is-open");
                        backdrop.classList.remove("is-visible");
                    });
                }
            })();
        </script>
    </body>
</html>
